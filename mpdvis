#!/bin/env bash
musicdir="/home/zoe/music" #set this to your MPD music dir

[ -f /tmp/albumart ] && feh -B black -R 2 --scale-down --g 300x300 /tmp/albumart &
[ -f /tmp/albumart ] && disown %1

for pid in $(ps -ef | grep "mpdvis" | awk '{print $2}')
do
	[ "$pid" != $$ ] && kill $pid
done

#################
#if ran with 0 arg, put current album art into /tmp/albumart
while true
do
	songdir=$(mpc -f %file% | head -1 | cut -d '/' -f 1)
	if [ -f "$musicdir/$songdir/"*".png" ] 
    then
        rm /tmp/albumart
		ln -s "$musicdir"/"${songdir%%/*}"/*.png /tmp/albumart
    fi
    if [ -f "/home/zoe/music/$songdir/"*".jpg" ]
    then
        rm /tmp/albumart
		ln -s "$musicdir"/"${songdir%%/*}"/*.jpg /tmp/albumart
    fi
    mpc current --wait
    echo fuck!
done
